(function(a){"function"==typeof define&&define.amd?define([],a):"object"==typeof exports?module.exports=a():window.Popup=a()})(function(){var a=function(a,b){var c=this,d=function(a,b){for(var c in a)void 0===b[c]?b[c]=a[c]:"object"==typeof b[c]&&d(a[c],b[c])};return c.options=b||{},c.selector=a,c.defaults={popupClass:"active",bodyClass:"no-scroll",fakeScrollbarClass:"active",mainPopupClass:"Popup",clickToClose:!0,escToClose:!0,allowPageScroll:!1,transitions:!0,animations:!1,fakeScrollbar:"#fake-scrollbar"},d(c.defaults,c.options),c.init(),c.$popup};return a.prototype.dispatchEvent=function(a,b){if("function"==typeof window.CustomEvent){var c=new CustomEvent(b);a.dispatchEvent(c)}},a.prototype.refresh=function(){var a=this.ctx||this;a.destroy(),a.init(a.selector)},a.prototype.destroy=function(){var a=this.ctx||this,b=a.$popup,c=a.$openButtons,d=a.$closeButtons;if(b){if(b.classList.remove(a.options.mainPopupClass),b.removeEventListener(a.endEvent,a.transitionEnd),b.removeEventListener("click",a.clickToClose),document.removeEventListener("keyup",a.closePopupHandler),c)for(var e=0;e<c.length;e++)c[e]&&c[e].removeEventListener("click",a.openPopupHandler);if(d)for(var e=0;e<d.length;e++)d[e]&&d[e].removeEventListener("click",a.closePopupHandler)}},a.prototype.init=function(){var a=this,b=a.options,c=function(a,b,c){return a="string"==typeof b?c?document.querySelectorAll(b):document.querySelector(b):b,a};a.$popup=c(a.$popup,a.selector),a.$openButtons=c(a.$openButtons,b.openButtons,!0),a.$closeButtons=c(a.$closeButtons,b.closeButtons,!0),a.$fakeScrollbar=c(a.$fakeScrollbar,b.fakeScrollbar),a.$popup.ctx=a,a.openPopupHandler={handleEvent:a.openPopup,ctx:a},a.closePopupHandler={handleEvent:a.closePopup,ctx:a},a.$popup.openPopup=a.openPopup,a.$popup.closePopup=a.closePopup,a.$popup.refreshPopup=a.refresh,a.$popup.destroyPopup=a.destroy,a.endEvent=b.transitions?"transitionend":!!b.animations&&"animationend",a.$popup.classList.add(b.mainPopupClass),a.initEvents(),"none"===a.$popup.style.display&&(a.$popup.style.display="",a.$popup.offsetWidth),a.dispatchEvent(a.$popup,"popupinit")},a.prototype.initEvents=function(){var a=this,b=a.$openButtons,c=a.$closeButtons;if(c)for(var d=0;d<c.length;d++)c[d]&&c[d].addEventListener("click",a.closePopupHandler);if(b)for(var d=0;d<b.length;d++)b[d]&&b[d].addEventListener("click",a.openPopupHandler);a.options.clickToClose&&a.$popup.addEventListener("click",a.clickToClose),a.options.escToClose&&document.addEventListener("keyup",a.closePopupHandler)},a.prototype.transitionEnd=function(){var a=this.ctx||this,b=a.$popup;"open"===a.action?a.dispatchEvent(b,"popupopen"):(a.dispatchEvent(b,"popupclose"),a.allowPageScroll()),b.removeEventListener(a.endEvent,a.transitionEnd)},a.prototype.clickToClose=function(){event.target===this&&this.closePopup()},a.prototype.openPopup=function(){var a=this.ctx||this,b=a.options,c=a.$fakeScrollbar,d=document.body,e=a.$popup;e.classList.contains(b.popupClass)||(event&&"click"===event.type&&(a.$caller=e.caller=event.target),a.action="open",a.dispatchEvent(e,"popupbeforeopen"),a.endEvent?e.addEventListener(a.endEvent,a.transitionEnd):a.dispatchEvent(e,"popupopen"),e.classList.add(b.popupClass),c&&(c.classList.add(b.fakeScrollbarClass),d.classList.add(b.bodyClass),d.style.paddingRight=c.offsetWidth-c.clientWidth+"px"))},a.prototype.closePopup=function(){if(!(event&&"keyup"===event.type&&27!==event.keyCode)){var a=this.ctx||this,b=a.options,c=a.$popup;c.classList.contains(b.popupClass)&&(a.action="close",a.dispatchEvent(c,"popupbeforeclose"),a.endEvent?c.addEventListener(a.endEvent,a.transitionEnd):(a.dispatchEvent(c,"popupclose"),a.allowpagescroll()),c.classList.remove(b.popupClass))}},a.prototype.allowPageScroll=function(){var a=this.ctx||this,b=a.options,c=a.$fakeScrollbar,d=document.body,e=Array.prototype.slice.call(document.querySelectorAll(".Popup"));c&&e.every(function(a){return!a.classList.contains(b.popupClass)})&&(d.style.paddingRight="",c.classList.remove(b.fakeScrollbarClass),d.classList.remove(b.bodyClass))},a});